@using System.Text;
@using System.IO;
@{
    string baseSiteUrl = Model.Site.Config["url"].ToString();
    string username = Model.Page.Bag["username"].ToString();
    string fullname= Model.Page.Bag["fullname"].ToString();
    string website = Model.Page.Bag["website"].ToString();
    string github = Model.Page.Bag["github"].ToString();
    string icon = Model.Page.Bag["icon"].ToString();
    string created = Model.Page.Bag["created"].ToString();
    string summary = Model.Page.Bag["summary"].ToString();
    string publicKeyFile = Model.Page.Bag["publickey"].ToString();
    publicKeyFile = Path.Combine(
      Model.Site.SourceFolder,
      publicKeyFile
    );

    var publicKeyBuilder = new StringBuilder();
    foreach( string line in File.ReadAllLines( publicKeyFile ) )
    {
        publicKeyBuilder.Append( line );
        publicKeyBuilder.Append( "\\n" );
    }
    publicKeyBuilder.Remove( publicKeyBuilder.Length - 2, 2 );
}
{
    "@@context": [
      "https://www.w3.org/ns/activitystreams",
      "https://w3id.org/security/v1"
    ],
    "outbox": "@(baseSiteUrl)dynamic/@username/outbox.json",
    "inbox": "@(baseSiteUrl)dynamic/@username/inbox.json",
    "preferredUsername": "@username",
    "attachment": [
    {
      "type": "PropertyValue",
      "name": "Website",
      "value": "\u003Ca href=\u0022@(website)\u0022 rel=\u0022me nofollow noopener noreferrer\u0022 target=\u0022_blank\u0022\u003E@(website)\u003C/a\u003E"
    },
    {
      "type": "PropertyValue",
      "name": "GitHub",
      "value": "\u003Ca href=\u0022@(github)\u0022 rel=\u0022me nofollow noopener noreferrer\u0022 target=\u0022_blank\u0022\u003E@(github)\u003C/a\u003E"
    }],
    "icon": [
      "@icon"
    ],
    "url": "@(baseSiteUrl)@@@username",
    "published": "@created",
    "summary": "@summary",
    "id": "@(baseSiteUrl)@@@username",
    "name": "@fullname",
    "discoverable": true,
    "manuallyApprovesFollowers": false,
    "type": "Service",
    "publicKey": {
        "id": "@(baseSiteUrl)@@@username#main-key",
        "owner": "@(baseSiteUrl)@@@username",
        "publicKeyPem": "@publicKeyBuilder"
    }
}
